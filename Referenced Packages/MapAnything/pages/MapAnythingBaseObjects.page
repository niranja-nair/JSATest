<apex:page title="MapAnything Settings" controller="sma.MapAnythingBaseObjects" setup="true" >
    <script type='text/javascript'>
        if (typeof $ == 'undefined')
        {
            document.write("<script type='text/javascript' src='{!URLFOR($Resource.MapAnything, 'js/jquery-1.7.1.min.js')}'></script"+">");
            document.write("<script type='text/javascript' src='{!URLFOR($Resource.MapAnything, 'jquery/jquery-ui.min.js')}'></script"+">");
            document.write("<link rel='stylesheet' type='text/css' href='{!URLFOR($Resource.MapAnything, 'jquery/jquery-ui.css')}'></link"+">");
            document.write("<script type='text/javascript' src='{!URLFOR($Resource.AdminSettings, 'js/date.js')}'></script"+">");
            document.write("<script type='text/javascript' src='{!URLFOR($Resource.MapAnything, 'jstree/jquery.jstree2.js')}'></script"+">");
        }
    </script>    
        
    <!-- jQuery Combo Box (depends on jQuery UI) -->
    <script src="{!URLFOR($Resource.AdminSettings, 'js/combobox/jquery.combobox.js')}" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.AdminSettings, 'js/combobox/jquery.combobox.css')}" />
    
    <!-- jQuery Multiselect (depends on jQuery UI) -->
    <script src="{!URLFOR($Resource.AdminSettings, 'js/multiselect/jquery.multiselect.min.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.AdminSettings, 'js/multiselect/jquery.multiselect.filter.js')}" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.AdminSettings, 'js/multiselect/jquery.multiselect.css')}" />
    <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.AdminSettings, 'js/multiselect/jquery.multiselect.filter.css')}" />    
        
    <!-- JS Color -->
    <apex:includeScript value="{!URLFOR($Resource.sma__MapAnything, 'jscolor/jscolor.js')}"/>
    
    <!-- Helpers -->
    <c:JSHelperFunctions />
    <c:CSSHelperBlue />

    <!-- CSS -->
    <apex:stylesheet value="{!URLFOR($Resource.sma__MapAnything, 'css/style.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.sma__MapAnything, 'style.css')}"/>
        
    <style type='text/css' class='adminsettings-css'>
        html, body {
            width: 100%;
            height: 100%;
        }
        .modal-layer {
            display: none;
            position: absolute;
            z-index: 1;
            width: 100%;
            height: 100%;
            background-color: #000000;
            opacity: 0.5;
            -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity = 50);
            filter: alpha(opacity = 50);
        }
    
        /* Basics */                
        #adminsettings-error {
            padding: 15px;
            width: 800px;
            overflow: hidden;
        
            {! IF(pageState != 'error', 'display: none;', '') }
        }
        #adminsettings-error h3 {
            display: block;
            margin: 10px 0;
            color: #757575;
        }
        #adminsettings { 
            padding: 15px;
            width: 95%;
            height: 95%;
            overflow: hidden;
            
            {! IF(pageState != 'edit', 'display: none;', '') }
        }
        #adminsettings .availableobject-settings {            
            width: 100%;
            overflow: hidden;
            display: none;
        }
        #adminsettings .baseobject-settings {            
            width: 100%;
            overflow: hidden;
            display: none;
        }
        #adminsettings .baseobject-settings .mapitdescription {
            color: #757575; 
            font-weight: bold;        
        }
        #adminsettings-templates {
            display: none;
        }
        span.link
        {
            color: blue;
            cursor: pointer;
        }
        span.link.small
        {
            font-size: 10px;
            font-weight: bold;
        }
        .dateliteralpicker
        {
            cursor: pointer;
        }
        .value input.invalid
        {
            background: transparent url({!URLFOR($Resource.QueryEditor, 'images/icons/badge-circle-cross-16.png')}) no-repeat right center;
        }
        .ui-autocomplete
        {
            z-index: 99999 !important;
            max-height: 300px !important;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .PICKLIST > ul, .filterbyowner ul
        {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .PICKLIST li, .filterbyowner li
        {
            padding: 0;
            margin: 0;
        }
        #adminsettings tr > td.actions > div, #adminsettings tr > td.crossfilteractions > div, #adminsettings tr > td.activitysubfilteractions > div
        {
            display: none;
        }
        #adminsettings tr:hover > td.actions > div, #adminsettings tr:hover > td.crossfilteractions > div, #adminsettings tr:hover > td.activitysubfilteractions > div
        {
            display: block;
        }        
        
        /* Tabs */ 
        #adminsettings .BottomTabs
        {
            background: none;
            border: none;
        }
        #adminsettings .BottomTabs > ul
        {
            width: auto;
            padding: 0 8px;
            background: none;
            border: none;
            border-bottom: 1px solid #CCC;
            border-top-right-radius: 0;
            border-top-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 0;
        }
        #adminsettings .BottomTabs > ul li
        {
            background-color: #006DB4;
            background: #006DB4;
            background: url('images/blue-tab-bg.png');
            background-repeat: repeat-x;
            background-position: top;
            background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#197BBB), to(#0059A0));
            background: -webkit-linear-gradient(top, #197BBB, #0059A0);
            background: -moz-linear-gradient(center top , #197BBB 20%, #0059A0 100%) repeat scroll 0 0 transparent;
            background: -ms-linear-gradient(top, #197BBB, #0059A0);
            background: -o-linear-gradient(top, #197BBB, #0059A0);
            border: medium none;
            border-radius: 3px 3px 0 0;
            border: 1px solid #19508C;
            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.3) inset, 0 0 4px rgba(255, 255, 255, 0.2) inset;
            
            
            
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#197BBB', endColorstr = '#0059A0');
            -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr = '#197BBB', endColorstr = '#0059A0')";
        }
        #adminsettings .BottomTabs > ul li.ui-tabs-selected
        {
            background: none;
            border: 1px solid #CCC;
            border-top-right-radius: 3px;
            border-top-left-radius: 3px;
            background: white;
            color: #222;
            
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#FFFFFF', endColorstr = '#FFFFFF');
            -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr = '#FFFFFF', endColorstr = '#FFFFFF')";
        }
        #adminsettings .BottomTabs > ul li a
        {
            color: #ffffff;
            font-size: 12px;
        }
        #adminsettings .BottomTabs > ul li.ui-tabs-selected a
        {
            color: #2265BB;
        }
        #adminsettings .BottomTabs > .ui-tabs-panel
        {
            padding: 15px;
            margin-bottom: 10px;
            border-bottom: 1px solid silver;
            //max-height: 420px;
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
        }
        
        /* Boxes */
        #adminsettings .box.gray {
            border: 1px solid #C7C7C7;
            padding:5px;
            margin:5px 0 10px 0;
            background:#efefef;
        }
        
        /* Sections */
        #adminsettings .section {
            position: relative;
        }
        #adminsettings .section .section-header {
            color: #2265BB;
        }
        #adminsettings .section .section-buttons {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        #adminsettings .section .section-buttons .section-button {
            padding-left: 18px;
            height: 16px;
            line-height: 18px;
            font-size: 10px;
            cursor: pointer;
        }
        #adminsettings .section .section-buttons .section-button.add {
            background: transparent url("{!URLFOR($Resource.QueryEditor, 'images/icons/badge-circle-plus-16.png')}") left center no-repeat;
        }
        
        /* Forms */
        #adminsettings table.form td:first-child {
            font-weight: bold;
            padding-right: 15px;
        }
                
        /* Buttons */
        #adminsettings .buttons {
            padding: 0 10px;
        }        
        #adminsettings .buttons-create {
            padding: 0 10px;
        }        
        #adminsettings .buttons-edit {
            padding: 0 10px;
        }
        #adminsettings .buttons-delete {
            padding: 0 10px;
        }
        #adminsettings .btn {
            width: 70px;
        }
        #adminsettings .btn2 {
            width: 150px;
        }
        
        /* Comboboxes */
        #adminsettings .ui-combobox
        {
            padding-right: 0;
        }
        #adminsettings .ui-combobox input
        {
            background-color: white;
            background: white;
            padding-right: 30px;
            font-weight: bold;
        }
        #adminsettings .ui-combobox a
        {
            background: transparent;
            border: none;
            position: absolute;
            right: 0;
        }
        #adminsettings .ui-combobox a .ui-button-icon-primary
        {
            background: transparent url("{!URLFOR($Resource.QueryEditor, 'images/icons/combobox-arrow-16.png')}") no-repeat center;
        }
        
        .crossobjectoptions input.ui-autocomplete-input {
            width: 300px;
        }
        
        /* Date pickers */
        #adminsettings .ui-datepicker {
            z-index: 9999999999 !important;
        }
        
        /* Create Fields Popup */
        #dialog-createfields-table-wrapper th span.link {
        	color: white;
        }
        .createablefield-row .createablefield-exists {
        	text-align: center;
        }
        
        /* Fix jsTree checkbox images */
        .jstree-default .jstree-unchecked > a > .jstree-checkbox:hover {
            background-position: -2px -41px;
        }
        .jstree-default .jstree-checked > a > .jstree-checkbox {
            background-position: -50px -19px;
        }
        .jstree-default .jstree-checked > a > .jstree-checkbox:hover {
            background-position: -50px -41px;
        }
        .jstree-default .jstree-undetermined > a > .jstree-checkbox {
            background-position: -26px -21px;
        }
        .jstree-default .jstree-undetermined > a > .jstree-checkbox:hover {
            background-position: -26px -42px;
        }
        
        /* Temporary fix for header links divider */
        span.divider {
        	float: none;
			display: inline;
			background: none;
			margin: 0;
        }
    </style>
    
    <script>         
        $(function() { 
            var SelectedSavedQueries = '';
            
            $( "#adminsettings .BottomTabs" ).tabs();
            
            FillBaseObjectComboBoxes();
            
            //comboboxes
            $('body').on('focus', '.ui-autocomplete-input', function () { var $me = $(this); setTimeout(function () {$me.select();}, 100); });
            $('.combobox').combobox();       
            
            //Initialize Saved Query tree popup dialog for Map It
            $( "#dialog-SQTree").dialog({
                autoOpen: false,
                height: 600,
                width: 450,
                modal: true,
                resizable:true,
                buttons: {
                    "Submit": function() {
                        SelectedSavedQueries = '';   
                        var SavedQueries = new Array();
                        $('#SQTree').jstree("get_checked",null,true).each(
                            function(index,element)
                            {
                                if($(element).attr("nodetype") ===  "PersonalSavedQuery" || $(element).attr("nodetype") ===  "CorporateSavedQuery")
                                {                                
                                    SavedQueries.push($(element).attr("id"));
                                }
                            }
                        );
                         
                        SelectedSavedQueries = SavedQueries.join(',');
                        $('#dialog-SQTree').dialog( "close" );
                        BuildMapItURL();
                    },
                     "Cancel": function() {                        
                        $('#dialog-SQTree').dialog( "close" );
                    }
                }           
            });
            
            //Initialize Saved Query tree for Map It
            $("#SQTree").jstree({
                "xml_data" : {
                    "data": "",
                    "ajax" : {
                        "url" : "/apex/MapAnythingTree2",
                        "data" : function (n) { 
                            
                            return { 
                                id : n.attr ? n.attr("id") : 0, 
                                rand : new Date().getTime(),
                                type: n.attr ? n.attr("NodeType") : 0
                            }; 
                        }
                    },
                    "xsl" : "nest"
                },
                "types" : {     
                    "types" : {
                        "savedquery" : {
                            "icon" : { 
                                "image" : "http://static.jstree.com/v.1.0rc/_docs/_drive.png" 
                            }
                        }
                    }
                },
                "core": { 
                    "animation" : 10, 
                    "strings": 
                        {
                            "loading" : "Loading...",
                            "new_node" : "New Folder" 
                        }
                
                },
                "plugins" : ["themes","xml_data","ui","crrm","types","checkbox"]
                                
            }); //End jstree
            
            
            
            
            
            /* Handle new Base Object onchange event */
            $('#adminsettings select.availableobject').change(function() {                
                var Object = $(this).val();
                if(Object === '--None--')
                {
                    $( '#adminsettings .availableobject-settings' ).hide();
                }
                else
                {                    
                    //show loading
                    $('.availableobject-settings .combobox').next().prepend("<div class='loadmask'></div>").find('input').val('Loading...');

                    //Populate available fields
                    $.getJSON("/apex/MAAdminAJAXResources","securityToken={!securityToken}&action=populate_available_fields&object=" + Object,function(json)
                    { 
                        if(json.success)
                        { 
                            var $addressloc = $("select.newbaseobjectdetails[data='addressloc']");
                            $addressloc.find('option').remove();
                            $('<option></option>').attr('value', '').text('Loading...').appendTo($addressloc);                      
                            $.each(json.RelationshipFields, function (i, record) 
                            {
                                if(record.value === 'SAME')
                                {
                                    $('<option selected="true"></option>').attr('value', record.value).text(record.name).appendTo($addressloc); 
                                }
                                else
                                {
                                    $('<option></option>').attr('value', record.value).text(record.name).appendTo($addressloc); 
                                }
                                                   
                            });
                            $addressloc.removeAttr('disabled').find('option:first-child').remove();
                            $addressloc.each(function(i, obj) {                          
                                $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                            });
                            $addressloc.combobox();
                           
                            var $addressfield = $("select.newbaseobjectdetails[data='addressfield']");
                            $addressfield.find('option:not(:first-child)').remove();                                                                       
                            $.each(json.AddressFields, function (i, record) 
                            {
                                $('<option></option>').attr('value', record.value).text(record.name).appendTo($addressfield);                
                            }); 
                            $addressfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);                          
                            $addressfield.each(function(i, obj) {                          
                                $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                            });
                            $addressfield.combobox();
                            
                            //Check In Settings
                            $('.newbaseobjectdetails .checkin-postto').val('Chatter|Task').next().find('input').val('Chatter & Task');
                            $('.newbaseobjectdetails .verification-distance').val('');
                            $('.newbaseobjectdetails .verification-unit').val('ft').next().find('input').val('Feet');
                            $('.newbaseobjectdetails .verification-required').attr('checked', false);
                            
                            var $coordinatefield = $("select.newbaseobjectdetails[data='coordinatefield']");
                            $coordinatefield.find('option:not(:first-child)').remove();                    
                            $.each(json.CoordinateFields, function (i, record) 
                            {
                                $('<option></option>').attr('value', record.value).text(record.name).appendTo($coordinatefield);                
                            }); 
                            $coordinatefield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                            $coordinatefield.each(function(i, obj) {                          
                                $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                            });
                            $coordinatefield.combobox();
                            
                            var $qualityfield = $("select.newbaseobjectdetails[data='qualityfield']");
                            $qualityfield.find('option:not(:first-child)').remove();                    
                            $.each(json.QualityFields, function (i, record) 
                            {
                                $('<option></option>').attr('value', record.value).text(record.name).appendTo($qualityfield);                
                            }); 
                            $qualityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                            $qualityfield.each(function(i, obj) {                          
                                $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                            });
                            $qualityfield.combobox();
                            
                            var $similarityfield = $("select.newbaseobjectdetails[data='similarityfield']");
                            $similarityfield.find('option:not(:first-child)').remove();                    
                            $.each(json.SimilarityFields, function (i, record) 
                            {
                                $('<option></option>').attr('value', record.value).text(record.name).appendTo($similarityfield);                
                            }); 
                            $similarityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);                            
                            $similarityfield.each(function(i, obj) {                          
                                $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                            });
                            $similarityfield.combobox();
                            
                            //hide loading
                            $('.availableobject-settings .combobox').next().find('input').closest('.ui-combobox').find('.loadmask').remove();
                            
                            $('#adminsettings .buttons-create').show();
                        }
                        else
                        {
                            $('#adminsettings .buttons-create .msgs').html('<b>Error retrieving Available fields</b>: Please try again').show();
                        }
                    })
                    .error(function(jqXHR, textStatus, errorThrown) { 
                        
                        $('#adminsettings .buttons-create .msgs').html('<b>Error retrieving Available fields</b>: ' + textStatus + ' : ' + errorThrown).show(); 
                    });
                    
                    $( '#adminsettings .availableobject-settings' ).show();
                }
            });
            
            /* Handle new Base Object Address location onchange event */
            $("select.newbaseobjectdetails[data='addressloc']").change(function() { 
                //show loading
                $('.availableobject-settings .combobox:not([data="addressloc"])').next().prepend("<div class='loadmask'></div>").find('input').val('Loading...');
                
                var AddressLocation = $(this).val();
                var Object = $('#adminsettings select.availableobject').val();
                
                //Repopulate available objects  (due to Address Location change)                
                $.getJSON("/apex/MAAdminAJAXResources","securityToken={!securityToken}&action=repopulate_available_fields&object=" + Object + "&addressloc=" + AddressLocation,function(json)
                { 
                    if(json.success)
                    { 
                        var $addressfield = $("select.newbaseobjectdetails[data='addressfield']");
                        $addressfield.find('option:not(:first-child)').remove();                                 
                        $.each(json.AddressFields, function (i, record) 
                        {
                            $('<option></option>').attr('value', record.value).text(record.name).appendTo($addressfield);                
                        }); 
                        $addressfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $addressfield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        var $coordinatefield = $("select.newbaseobjectdetails[data='coordinatefield']");
                        $coordinatefield.find('option:not(:first-child)').remove();              
                        $.each(json.CoordinateFields, function (i, record) 
                        {
                            $('<option></option>').attr('value', record.value).text(record.name).appendTo($coordinatefield);                
                        }); 
                        $coordinatefield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $coordinatefield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        var $qualityfield = $("select.newbaseobjectdetails[data='qualityfield']");
                        $qualityfield.find('option:not(:first-child)').remove();                
                        $.each(json.QualityFields, function (i, record) 
                        {
                            $('<option></option>').attr('value', record.value).text(record.name).appendTo($qualityfield);                
                        }); 
                        $qualityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $qualityfield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        var $similarityfield = $("select.newbaseobjectdetails[data='similarityfield']");
                        $similarityfield.find('option:not(:first-child)').remove();              
                        $.each(json.SimilarityFields, function (i, record) 
                        {
                                $('<option></option>').attr('value', record.value).text(record.name).appendTo($similarityfield);                
                        }); 
                        $similarityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $similarityfield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        //hide loading
                        $('.availableobject-settings .combobox:not([data="addressloc"])').next().find('.loadmask').remove();
                        
                        $('#adminsettings .buttons-create').show();
                    }
                    else
                    {
                        $('#adminsettings .buttons-create .msgs').html('<b>Error retrieving Available fields</b>: Please try again').show();
                    }
                })
                .error(function(jqXHR, textStatus, errorThrown) { 
                    
                    $('#adminsettings .buttons-create .msgs').html('<b>Error retrieving Available fields</b>: ' + textStatus + ' : ' + errorThrown).show(); 
                });
                
            });
            
            /* Handle edit Base Object onchange event */
            $('#adminsettings select.baseobject').change(function() {
                //show loading
                $('.baseobject-settings .combobox').next().prepend("<div class='loadmask'></div>").find('input').val('Loading...');
                                
                var Object = $(this).val();
                if(Object === '--None--')
                {
                    $( '#adminsettings .baseobject-settings' ).hide();
                }
                else
                {
                    //Populate available fields and query existing Base Object
                    $.getJSON("/apex/MAAdminAJAXResources","securityToken={!securityToken}&action=get_existing_object&object=" + Object,function(json)
                    { 
                        if(json.success)
                        {   
                        	//namespace removal
                        	removeNamespace('{!namespace}', json.BaseObject);
                        
                            //Set Read-Only Base Object output
                            $("span.readonlybaseobject").html('<b>' + json.BaseObject.Name + '</b>');
                            
                            var $addressloc = $("select.editbaseobjectdetails[data='addressloc']");
                            $addressloc.find('option').remove();
                            $('<option></option>').attr('value', '').text('Loading...').appendTo($addressloc);                      
                            $.each(json.RelationshipFields, function (i, record) 
                            {
                                if(record.value === json.BaseObject.AddressObject__c)
                                {
                                    $('<option selected="true"></option>').attr('value', record.value).text(record.name).appendTo($addressloc);
                                }
                                else
                                {
                                    $('<option></option>').attr('value', record.value).text(record.name).appendTo($addressloc);
                                }
                                                
                            }); 
                            $addressloc.removeAttr('disabled').find('option:first-child').remove();
                            //Set default value(s)
                            $addressloc.each(function(i, obj) {                          
                                $(this).next().find('.ui-autocomplete-input').val($addressloc.find('option:selected').text());                         
                            });
                            $addressloc.combobox();
                           
                            var $addressfield = $("select.editbaseobjectdetails[data='addressfield']");
                            $addressfield.find('option:not(:first-child)').remove();                                                                       
                            $.each(json.AddressFields, function (i, record) 
                            {
                                    $('<option></option>').attr('value', record.value).text(record.name).appendTo($addressfield);                
                            }); 
                            $addressfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--'); 
                            
                            //Set default value(s)
                            $('#adminsettings input.editname').val(json.BaseObject.Name__c).next().find('.ui-autocomplete-input').val(json.BaseObject.Name__c);
                            $('#editskipfailedgeocodes').attr('checked', json.supportsSkipGeocoding && json.BaseObject.SkipFailedGeocodes__c);
                            $('#editstreet').val(json.BaseObject.Street__c).next().find('.ui-autocomplete-input').val($('#editstreet option:selected').text());
                            $('#editpostalcode').val(json.BaseObject.PostalCode__c).next().find('.ui-autocomplete-input').val($('#editpostalcode option:selected').text());
                            $('#editcity').val(json.BaseObject.City__c).next().find('.ui-autocomplete-input').val($('#editcity option:selected').text());
                            $('#editcountry').val(json.BaseObject.Country__c).next().find('.ui-autocomplete-input').val($('#editcountry option:selected').text());
                            $('#editstate').val(json.BaseObject.State__c).next().find('.ui-autocomplete-input').val($('#editstate option:selected').text());                
                            $('#editcleanstreet').val(json.BaseObject.CleanStreet__c).next().find('.ui-autocomplete-input').val($('#editcleanstreet option:selected').text());
                            $('#editcleancity').val(json.BaseObject.CleanCity__c).next().find('.ui-autocomplete-input').val($('#editcleancity option:selected').text());
                            $('#editcleanstate').val(json.BaseObject.CleanState__c).next().find('.ui-autocomplete-input').val($('#editcleanstate option:selected').text());
                            $('#editcleanzip').val(json.BaseObject.CleanPostalCode__c).next().find('.ui-autocomplete-input').val($('#editcleanzip option:selected').text());
                            $('#editcleancountry').val(json.BaseObject.CleanCountry__c).next().find('.ui-autocomplete-input').val($('#editcleancountry option:selected').text());
                            $('#editcleancounty').val(json.BaseObject.CleanCounty__c).next().find('.ui-autocomplete-input').val($('#editcleancounty option:selected').text());
                            $('#editcleandistrict').val(json.BaseObject.CleanDistrict__c).next().find('.ui-autocomplete-input').val($('#editcleandistrict option:selected').text());
                            
                            //show a message if skipping geocoding is not supported
                            if (!json.supportsSkipGeocoding) {
                            	$('#editskipfailedgeocodes').hide().next().show();
                            }
                            
                            $addressfield.combobox();
                            
                            var $coordinatefield = $("select.editbaseobjectdetails[data='coordinatefield']");
                            $coordinatefield.find('option:not(:first-child)').remove();                    
                            $.each(json.CoordinateFields, function (i, record) 
                            {
                                    $('<option></option>').attr('value', record.value).text(record.name).appendTo($coordinatefield);                
                            }); 
                            $coordinatefield.removeAttr('disabled').find('option:first-child').text('--Please Choose--');
                            //Set default value(s)
                            $('#editlatitude').val(json.BaseObject.Latitude__c).next().find('.ui-autocomplete-input').val($('#editlatitude option:selected').text());
                            $('#editlongitude').val(json.BaseObject.Longitude__c).next().find('.ui-autocomplete-input').val($('#editlongitude option:selected').text());
                            $('#editverifiedlatitude').val(json.BaseObject.VerifiedLatitude__c).next().find('.ui-autocomplete-input').val($('#editverifiedlatitude option:selected').text());
                            $('#editverifiedlongitude').val(json.BaseObject.VerifiedLongitude__c).next().find('.ui-autocomplete-input').val($('#editverifiedlongitude option:selected').text());
                            $coordinatefield.combobox();
                            
                            var $qualityfield = $("select.editbaseobjectdetails[data='qualityfield']");
                            $qualityfield.find('option:not(:first-child)').remove();                    
                            $.each(json.QualityFields, function (i, record) 
                            {
                                    $('<option></option>').attr('value', record.value).text(record.name).appendTo($qualityfield);                
                            }); 
                            $qualityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--');
                            //Set default value(s)
                            $('#editquality').val(json.BaseObject.Quality__c).next().find('.ui-autocomplete-input').val($('#editquality option:selected').text());
                            $qualityfield.combobox();
                            
                            var $similarityfield = $("select.editbaseobjectdetails[data='similarityfield']");
                            $similarityfield.find('option:not(:first-child)').remove();                    
                            $.each(json.SimilarityFields, function (i, record) 
                            {
                                    $('<option></option>').attr('value', record.value).text(record.name).appendTo($similarityfield);                
                            }); 
                            $similarityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--');
                            //Set default value(s)
                            $('#editsimilarity').val(json.BaseObject.Similarity__c).next().find('.ui-autocomplete-input').val($('#editsimilarity option:selected').text());
                            $similarityfield.combobox();
                            
                            //check in settings
                            try { 
                            	var settings = JSON.parse(json.BaseObject.Settings__c);
                            	$('.editbaseobjectdetails .checkin-postto').val(settings.CheckInPostTo).next().find('input').val($('.editbaseobjectdetails .checkin-postto').find('option:selected').text());
                            	$('.editbaseobjectdetails .verification-distance').val(settings.VerificationDistance);
                           		$('.editbaseobjectdetails .verification-unit').val(settings.VerificationUnit).next().find('input').val($('.editbaseobjectdetails .verification-unit').find('option:selected').text());
                           		$('.editbaseobjectdetails .verification-required').attr('checked', settings.VerificationRequired ? 'checked' : false);
                            } 
                            catch (err) { 
                            	$('.editbaseobjectdetails .checkin-postto').val('Chatter|Task').next().find('input').val($('.editbaseobjectdetails .checkin-postto').find('option:selected').text());
                            	$('.editbaseobjectdetails .verification-distance').val('');
                           		$('.editbaseobjectdetails .verification-unit').val('ft').next().find('input').val($('.editbaseobjectdetails .verification-unit').find('option:selected').text());
                           		$('.editbaseobjectdetails .verification-required').attr('checked', false);
                            }
                            
                            //Handle Map It Section
                            var $tooltip1 = $("select.editbaseobjectdetails[data='tooltip1']");
                            $tooltip1.find('option').remove();
                            $('<option></option>').attr('value', '').text('Loading...').appendTo($tooltip1);                      
                            $.each(json.TooltipFields, function (i, record) 
                            {                                
                                if(record.value === 'Name')
                                {
                                    $('<option selected="true"></option>').attr('value', record.value).text(record.name).appendTo($tooltip1);
                                }
                                else
                                {
                                    $('<option></option>').attr('value', record.value).text(record.name).appendTo($tooltip1);
                                }
                                                                                                                
                            }); 
                            $tooltip1.removeAttr('disabled').find('option:first-child').remove();
                            //Set default value(s)
                            $tooltip1.each(function(i, obj) {                          
                                $(this).next().find('.ui-autocomplete-input').val($tooltip1.find('option:selected').text());                         
                            });
                            $tooltip1.combobox();
                            
                            var $tooltips = $("select.editbaseobjectdetails[data='tooltipfield']");
                            $tooltips.find('option:not(:first-child)').remove();                     
                            $.each(json.TooltipFields, function (i, record) 
                            {
                                $('<option></option>').attr('value', record.value).text(record.name).appendTo($tooltips);
                            }); 
                            $tooltips.removeAttr('disabled').find('option:first-child').text('--Please Choose--');
                            //Set default value(s)
                            $tooltips.each(function(i, obj) {                          
                                $(this).val('').next().find('.ui-autocomplete-input').val('--Please Choose--');                         
                            });
                            $tooltips.combobox();
                            
                            $mapitdesc = $('#adminsettings .baseobject-settings .mapitdescription');
                            $mapitdesc.text('The Map It feature allows you to plot any record on the map with just one click.  In order to enable the Map It feature for ' + json.BaseObjectLabelPlural + ', you will need to create a custom button.  If you need help with that, search for "defining custom buttons and links" in the standard Salesforce documentation.  Use the tools below to determine the appropriate URL for your button to point to.');
                            $mapitdesc.attr('BaseObjectName',json.BaseObject.Name);
                            $mapitdesc.attr('BaseObjectId',json.BaseObject.Id);                            
                            BuildMapItURL();
                            
                            //hide loading
                            $('.baseobject-settings .combobox').next().find('input').closest('.ui-combobox').find('.loadmask').remove();
                            
                            $('#adminsettings .buttons-edit').show();
                        }
                        else
                        {
                            $('#adminsettings .buttons-edit .msgs').html('<b>Error retrieving Available fields</b>: Please try again').show();
                        }
                    })
                    .error(function(jqXHR, textStatus, errorThrown) { 
                        
                        $('#adminsettings .buttons-edit .msgs').html('<b>Error retrieving Available fields</b>: ' + textStatus + ' : ' + errorThrown).show(); 
                    });
                    
                    $( '#adminsettings .baseobject-settings' ).show();
                }
            });
            
            /* Handle edit Base Object Address location onchange event */
            $("select.editbaseobjectdetails[data='addressloc']").change(function() { 
                //show loading
                $('.baseobject-settings .combobox:not([data="addressloc"])').next().prepend("<div class='loadmask'></div>").find('input').val('Loading...');
                
                var AddressLocation = $(this).val();
                var Object = $('#adminsettings select.baseobject').val();
                
                //Repopulate available objects  (due to Address Location change)                
                $.getJSON("/apex/MAAdminAJAXResources","securityToken={!securityToken}&action=repopulate_edit_available_fields&object=" + Object + "&addressloc=" + AddressLocation,function(json)
                { 
                    if(json.success)
                    {                         
                        var $addressfield = $("select.editbaseobjectdetails[data='addressfield']");
                        $addressfield.find('option:not(:first-child)').remove();                                 
                        $.each(json.AddressFields, function (i, record) 
                        {
                            $('<option></option>').attr('value', record.value).text(record.name).appendTo($addressfield);                
                        }); 
                        $addressfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $addressfield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        var $coordinatefield = $("select.editbaseobjectdetails[data='coordinatefield']");
                        $coordinatefield.find('option:not(:first-child)').remove();              
                        $.each(json.CoordinateFields, function (i, record) 
                        {
                            $('<option></option>').attr('value', record.value).text(record.name).appendTo($coordinatefield);                
                        }); 
                        $coordinatefield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $coordinatefield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        var $qualityfield = $("select.editbaseobjectdetails[data='qualityfield']");
                        $qualityfield.find('option:not(:first-child)').remove();                
                        $.each(json.QualityFields, function (i, record) 
                        {
                            $('<option></option>').attr('value', record.value).text(record.name).appendTo($qualityfield);                
                        }); 
                        $qualityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $qualityfield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        var $similarityfield = $("select.editbaseobjectdetails[data='similarityfield']");
                        $similarityfield.find('option:not(:first-child)').remove();              
                        $.each(json.SimilarityFields, function (i, record) 
                        {
                                $('<option></option>').attr('value', record.value).text(record.name).appendTo($similarityfield);                
                        }); 
                        $similarityfield.removeAttr('disabled').find('option:first-child').text('--Please Choose--').attr('selected',true);
                        $similarityfield.each(function(i, obj) {                          
                            $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                        });
                        
                        //hide loading
                        $('.baseobject-settings .combobox:not([data="addressloc"])').next().find('.loadmask').remove();
                        
                        $('#adminsettings .buttons-edit').show();
                    }
                    else
                    {
                        $('#adminsettings .buttons-edit .msgs').html('<b>Error retrieving Available fields</b>: Please try again').show();
                    }
                })
                .error(function(jqXHR, textStatus, errorThrown) { 
                    
                    $('#adminsettings .buttons-edit .msgs').html('<b>Error retrieving Available fields</b>: ' + textStatus + ' : ' + errorThrown).show(); 
                });
                
            });
            
            /* Handle edit Base Object onchange event */
            $('#adminsettings select.deletebaseobject').change(function() {                
                var Object = $(this).val();
                if(Object === '--None--')
                {
                    $('#adminsettings .buttons-delete').hide();
                }
                else
                {
                    $('#adminsettings .buttons-delete').show();
                }
            });
            
            //handle selecting all/none when creating fields
            $('#dialog-createfields-table-wrapper th span.link').click(function () {
            	if ($(this).is('.selectall')) {
            		$('input.createablefield-create').attr('checked', 'checked');
            	}
            	else if ($(this).is('.selectnone')) {
            		$('input.createablefield-create').attr('checked', false);
            	}
            });
            
            //handle creating fields
            $('#adminsettings .buttons-create .createfieldsbtn, #adminsettings .buttons-edit .createfieldsbtn').click(function () 
            {
            	var baseObject = $(this).is('.buttons-create .createfieldsbtn') ? $('#BottomTabs-1 .availableobject').val() : $('.editbaseobjectdetails.readonlybaseobject b').text();
            	
            	//show loading
            	launchPopup($('#dialog-createfields'), {
            		minWidth: '600px',
            		buttons: {
            			'Create': function () {
            			
            				//show loading
            				var $dialog = showLoading($(this).closest('.ui-dialog'), 'Creating...');
            			
            				//generate batches of fields to create (only 10 fields can be made per request)
            				var fieldsToCreateBatches = [];
            				var fieldsToCreate = [];
            				$('#dialog-createfields-table .createablefield-create:checked').each(function () {
            					fieldsToCreate.push($(this).closest('.createablefield-row').data('createableField'));
            					
            					if (fieldsToCreate.length == 10)
            					{
            						//move to the next batch
            						fieldsToCreateBatches.push(fieldsToCreate);
            						fieldsToCreate = [];
            					}
            				});
            				
            				//add the last batch if needed
            				if (fieldsToCreate.length > 0)
            				{
            					fieldsToCreateBatches.push(fieldsToCreate);
            				}
            				
            				//send requests to create fields
            				var requestsOut = 0;
            				var requestErrors = 0;
            				var creationFailures = 0;
							var lastError = '';
            				$.each(fieldsToCreateBatches, function (index, batch) {
            				
            					//send this batch
            					requestsOut++;
	            				var requestData = {
				            		securityToken				: '{!securityToken}',
				            		action						: 'create_fields',
				            		baseObject					: baseObject,
				            		serializedCreateableFields	: JSON.stringify(batch)
				            	};
	            				$.getJSON("/apex/MAAdminAJAXResources", requestData, function(response) {
				                	if (response.success)
				                	{
				                		//get a list of ids that were returned (these are process ids that can be used to get the status of the request)
				                		var resultIds = [];
				                		$.each((response.results || []), function (index, result) {
				                			resultIds.push(result.id);
				                		});
				                	
				                		//create a timeout to keep checking metadata status until the requests are done
				                		setTimeout(function checkMetadataTimeout() {
				                				
			                				//send request to check status
			                				var requestData = {
			                					securityToken	: '{!securityToken}',
		            							action			: 'check_metadata_status',
		            							serializedIds	: JSON.stringify(resultIds)
			                				};
			                				$.getJSON("/apex/MAAdminAJAXResources", requestData, function(response) {
							                	if (response.success)
							                	{
							                		//compile results
							                		var isDone = true;
							                		var batchFailures = 0;
							                		$.each(response.results, function (index, result) {
							                		
							                			//track completion and failure
							                			if (!result.done) {
							                				isDone = false;
							                				return false;
							                			}
							                			else if (result.statusCode) {
							                				batchFailures++;
							                				lastError = '  ('+result.message+')';
							                			}
							                			
							                		});
							                		
							                		//if we're done, show status and reload the table.  if not, check again
							                		if (isDone) {
							                			requestsOut--;
							                			creationFailures += batchFailures;
							                		}
							                		else {
							                			setTimeout(checkMetadataTimeout, 500);
							                		} 
							                	}
							                	else
							                	{
							                		showError($dialog, 'Unknown Error');
							                	}
							                }).error(function () { showError($dialog, 'Unknown Error'); });
			                				
			                			}, 1000);
				                	}
				                	else
				                	{
				                		requestsOut--;
				                		creationFailures += batch.length;
				                	}
				                })
				                .error(function(jqXHR, textStatus, errorThrown) {
				                	requestsOut--;
				                	creationFailures += batch.length;
				                });
			                });
            				
            				//done sending batches.  now start polling for completion
            				setTimeout(function checkCreationRequestsTimeout() {
            					if (requestsOut == 0)
            					{
            						//done.  show success
            						showSuccess($dialog, 'Done.  ' + creationFailures + ' failures.' + lastError, creationFailures > 0 ? 2500 : 1500, function () {
		                				loadCreateableFields(baseObject);
		                				$('#BottomTabs-1 .availableobject').change();
		                				$('#BottomTabs-2 .baseobject').change();
		                				$('.suggestbtn').click();
		                			});
            					}
            					else
            					{
            						//not done.  keep polling
            						setTimeout(checkCreationRequestsTimeout, 1000);
            					}
            				}, 1000);
            			},
						'Close': function () { 
							hidePopup($('#dialog-createfields')); 
						}
					}
            	});
            	
            	loadCreateableFields(baseObject);
            });
            
            //Suggest fields
            $('#adminsettings .buttons-create .suggestbtn, #adminsettings .buttons-edit .suggestbtn').click(function () 
            {
            	var prefix = $(this).is('.buttons-create .suggestbtn') ? 'create' : 'edit';
            	
                //Handle regular address fields
                $('#'+prefix+'street > option').each(function() {
                    var FieldNameLowered = this.value.toLowerCase();                    
                    if (FieldNameLowered.indexOf('street') !== -1 && !FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'street').val() == '--Please Choose--' || $('#'+prefix+'street').val() == ''))
                    {
                       $('#'+prefix+'street').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }                   
                    else if (FieldNameLowered.indexOf('city') !== -1 && !FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'city').val() == '--Please Choose--' || $('#'+prefix+'city').val() == ''))
                    {
                       $('#'+prefix+'city').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('state') !== -1 && !FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'state').val() == '--Please Choose--' || $('#'+prefix+'state').val() == ''))
                    {
                       $('#'+prefix+'state').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('postalcode') !== -1 && !FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'postalcode').val() == '--Please Choose--' || $('#'+prefix+'postalcode').val() == ''))
                    {
                       $('#'+prefix+'postalcode').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('country') !== -1 && !FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'country').val() == '--Please Choose--' || $('#'+prefix+'country').val() == ''))
                    {
                       $('#'+prefix+'country').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                });
                
                //Handle Coordinate fields
                $('#'+prefix+'latitude > option').each(function() {
                    var FieldNameLowered = this.value.toLowerCase();
                    if (FieldNameLowered.indexOf('latitude') !== -1 && FieldNameLowered.indexOf('verified') !== -1 && ($('#'+prefix+'verifiedlatitude').val() == '--Please Choose--' || $('#'+prefix+'verifiedlatitude').val() == ''))
                    {
                       $('#'+prefix+'verifiedlatitude').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('longitude') !== -1 && FieldNameLowered.indexOf('verified') !== -1 && ($('#'+prefix+'verifiedlongitude').val() == '--Please Choose--' || $('#'+prefix+'verifiedlongitude').val() == ''))
                    {
                       $('#'+prefix+'verifiedlongitude').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('latitude') !== -1 && ($('#'+prefix+'latitude').val() == '--Please Choose--' || $('#'+prefix+'latitude').val() == ''))
                    {
                       $('#'+prefix+'latitude').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('longitude') !== -1 && ($('#'+prefix+'longitude').val() == '--Please Choose--' || $('#'+prefix+'longitude').val() == ''))
                    {
                       $('#'+prefix+'longitude').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }                    
                });
                
                //Handle clean address fields
                $('#'+prefix+'cleanstreet > option').each(function() {
                    var FieldNameLowered = this.value.toLowerCase();                    
                    if (FieldNameLowered.indexOf('street') !== -1 && FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'cleanstreet').val() == '--Please Choose--' || $('#'+prefix+'cleanstreet').val() == ''))
                    {
                       $('#'+prefix+'cleanstreet').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }                   
                    else if (FieldNameLowered.indexOf('city') !== -1 && FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'cleancity').val() == '--Please Choose--' || $('#'+prefix+'cleancity').val() == ''))
                    {
                       $('#'+prefix+'cleancity').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('state') !== -1 && FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'cleanstate').val() == '--Please Choose--' || $('#'+prefix+'cleanstate').val() == ''))
                    {
                       $('#'+prefix+'cleanstate').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if ((FieldNameLowered.indexOf('postalcode') !== -1 || (FieldNameLowered.indexOf('postal') !== -1 && FieldNameLowered.indexOf('code') !== -1)) && FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'cleanzip').val() == '--Please Choose--' || $('#'+prefix+'cleanzip').val() == ''))
                    {
                       $('#'+prefix+'cleanzip').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('country') !== -1 && FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'cleancountry').val() == '--Please Choose--' || $('#'+prefix+'cleancountry').val() == ''))
                    {
                       $('#'+prefix+'cleancountry').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('county') !== -1 && FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'cleancounty').val() == '--Please Choose--' || $('#'+prefix+'cleancounty').val() == ''))
                    {
                       $('#'+prefix+'cleancounty').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                    else if (FieldNameLowered.indexOf('district') !== -1 && FieldNameLowered.indexOf('clean') !== -1 && ($('#'+prefix+'cleandistrict').val() == '--Please Choose--' || $('#'+prefix+'cleandistrict').val() == ''))
                    {
                       $('#'+prefix+'cleandistrict').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }
                });    
                
                //Handle Quality fields
                $('#'+prefix+'quality > option').each(function() {
                    var FieldNameLowered = this.value.toLowerCase();                    
                    if (FieldNameLowered.indexOf('quality') !== -1 && ($('#'+prefix+'quality').val() == '--Please Choose--' || $('#'+prefix+'quality').val() == ''))
                    {
                       $('#'+prefix+'quality').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }                 
                });
                
                //Handle Similarity fields
                $('#'+prefix+'similarity > option').each(function() {
                    var FieldNameLowered = this.value.toLowerCase();                    
                    if (FieldNameLowered.indexOf('similarity') !== -1 && ($('#'+prefix+'similarity').val() == '--Please Choose--' || $('#'+prefix+'similarity').val() == ''))
                    {
                       $('#'+prefix+'similarity').val(this.value).next().find('.ui-autocomplete-input').val(this.text);
                    }                 
                });                        
            });
            
            /*****************
            * Map It Functions
            ******************/
            $('#adminsettings .baseobject-settings input.color').change(function() { 
                BuildMapItURL();
            });
            
            $('#tooltip1').change(function() { 
                BuildMapItURL();
            });
            
            $("#adminsettings select.editbaseobjectdetails[data='tooltipfield']").change(function() { 
                BuildMapItURL();
            });
                        
            //Handle Plot Visible Area Checkbox on change
            $("#adminsettings input.plotvisibleflag").change(function () 
            {                
                BuildMapItURL();
            });
            
            //Handle select Map It URL
            $("#adminsettings .selecturlbtn ").click(function () 
            {
                document.getElementById('mapiturl').select();
            });
            
            
            
            function BuildMapItURL()
            {
                $mapitdesc = $('#adminsettings .baseobject-settings .mapitdescription');
                var ObjectName = $mapitdesc.attr('BaseObjectName');
                var ObjectId = $mapitdesc.attr('BaseObjectId');
                var MarkerColor = $('#adminsettings .baseobject-settings input.color').val();
                
                var MapItURL = '{!BaseURL}?recordId=\{\!' + ObjectName + '.Id\}&baseObjectId=' + ObjectId + '&tooltipField=' + $("#tooltip1").val() 
                               + (($("#tooltip2").val() != '' && $("#tooltip2").val() != '--Please Choose--') ? ('&tooltipField2=' + $("#tooltip2").val()) : '')
                               + (($("#tooltip3").val() != '' && $("#tooltip3").val() != '--Please Choose--') ? ('&tooltipField3=' + $("#tooltip3").val()) : '')
                               + (($("#tooltip4").val() != '' && $("#tooltip4").val() != '--Please Choose--') ? ('&tooltipField4=' + $("#tooltip4").val()) : '')
                               + (($("#tooltip5").val() != '' && $("#tooltip5").val() != '--Please Choose--') ? ('&tooltipField5=' + $("#tooltip5").val()) : '')
                               + (($("#tooltip6").val() != '' && $("#tooltip6").val() != '--Please Choose--') ? ('&tooltipField6=' + $("#tooltip6").val()) : '')
                               + (($("#tooltip7").val() != '' && $("#tooltip7").val() != '--Please Choose--') ? ('&tooltipField7=' + $("#tooltip7").val()) : '')
                               + ((SelectedSavedQueries != '') ? ('&savedQueries=' + SelectedSavedQueries) : '')
                               + (($("#adminsettings input.plotvisibleflag").is(':checked')) ? '&plotVisibleArea=true' : '')
                               + '&color=' + encodeURIComponent(MarkerColor);
                
                $('#adminsettings .baseobject-settings textarea.mapiturl').val(MapItURL);
                
            }
            
            //Handle Add Saved Queries for Map It
            $('#adminsettings .addqueriesbtn').click(function () 
            {                
                $( "#dialog-SQTree" ).dialog( "open" );
            });
            
            /****************************
            *  DML Ajax Handler Functions
            ****************************/            
            
            //Handle Create New Save
            $('#adminsettings .buttons-create .savebtn').click(function () 
            {
                //build settings objects
                var settings = {
                	CheckInPostTo			: $('.newbaseobjectdetails .checkin-postto').val(),
                	VerificationDistance	: $('.newbaseobjectdetails .verification-distance').val(),
                	VerificationUnit		: $('.newbaseobjectdetails .verification-unit').val(),
                	VerificationRequired	: $('.newbaseobjectdetails .verification-required').is(':checked')
                };
                var BaseObject = {
                    Name:                  $('#adminsettings .availableobject').val(),
                    AddressObject__c:      $("select.newbaseobjectdetails[data='addressloc']").val(),
                    Name__c:               $('#adminsettings input.createname').val(),
                    Street__c:             $('#createstreet').val() == '--Please Choose--' ? '' : $('#createstreet').val(),
                    PostalCode__c:         $('#createpostalcode').val() == '--Please Choose--' ? '' : $('#createpostalcode').val(),
                    City__c:               $('#createcity').val() == '--Please Choose--' ? '' : $('#createcity').val(),
                    Country__c:            $('#createcountry').val() == '--Please Choose--' ? '' : $('#createcountry').val(),
                    State__c:              $('#createstate').val() == '--Please Choose--' ? '' : $('#createstate').val(),
                    Latitude__c:           $('#createlatitude').val() == '--Please Choose--' ? '' : $('#createlatitude').val(),
                    Longitude__c:          $('#createlongitude').val() == '--Please Choose--' ? '' : $('#createlongitude').val(),
                    VerifiedLatitude__c:   $('#createverifiedlatitude').val() == '--Please Choose--' ? '' : $('#createverifiedlatitude').val(),
                    VerifiedLongitude__c:  $('#createverifiedlongitude').val() == '--Please Choose--' ? '' : $('#createverifiedlongitude').val(),
                    CleanStreet__c:        $('#createcleanstreet').val() == '--Please Choose--' ? '' : $('#createcleanstreet').val(),
                    CleanCity__c:          $('#createcleancity').val() == '--Please Choose--' ? '' : $('#createcleancity').val(),
                    CleanState__c:         $('#createcleanstate').val() == '--Please Choose--' ? '' : $('#createcleanstate').val(),
                    CleanPostalCode__c:    $('#createcleanzip').val() == '--Please Choose--' ? '' : $('#createcleanzip').val(),
                    CleanCountry__c:       $('#createcleancountry').val() == '--Please Choose--' ? '' : $('#createcleancountry').val(),
                    CleanCounty__c:        $('#createcleancounty').val() == '--Please Choose--' ? '' : $('#createcleancounty').val(),
                    CleanDistrict__c:      $('#createcleandistrict').val() == '--Please Choose--' ? '' : $('#createcleandistrict').val(),
                    Similarity__c:         $('#createsimilarity').val() == '--Please Choose--' ? '' : $('#createsimilarity').val(),
                    Quality__c:            $('#createquality').val() == '--Please Choose--' ? '' : $('#createquality').val(),
                    Settings__c: 			JSON.stringify(settings)
                };
                
                //determine if at least one address field is filled in
                var addressFields = ['Street__c','City__c','State__c','PostalCode__c','Country__c'];
                var addressFieldsValid = false;
                $.each(addressFields, function (index, fieldName) {
                	if (BaseObject[fieldName] != undefined && BaseObject[fieldName] != '') {
                		addressFieldsValid = true;
                		return false;
                	}
                });
                
                //make sure we have all the required fields filled in
                if(addressFieldsValid && BaseObject.Name__c != undefined && BaseObject.Name__c != '' && BaseObject.Latitude__c != undefined && BaseObject.Latitude__c != '' && BaseObject.Longitude__c != undefined && BaseObject.Longitude__c != '')
                {
                    //add saving indicator
                    var $tab = showLoading($(this).closest('.ui-tabs-panel'), 'Saving...');
                    
                    //send request
                    $.ajax({
                        url: "/apex/MAAdminAJAXResources?securityToken={!securityToken}&action=save_base_object",
                        type: 'POST',
                        dataType: 'JSON',
                        data: { BaseObject: JSON.stringify(addNamespace('{!namespace}', BaseObject)) },
                        success: function (json)
                        {
                            if (json.success)
                            {
                                showSuccess($tab, 'Save Successful', 1500, function () {
                                	FillBaseObjectComboBoxes();
                                	HideAll();
                                });
                            }
                            else
                            {
                                //show error message
                                showError($tab, 'Save Error: Please try again');
                            }
                        },
                        error: function (request, error, exception)
                        {
                            //show error
                            showError($tab, 'Save Error: Please try again');
                        }
                    });     
                }
                else
                {
                    showError($(this).closest('.ui-tabs-panel'), 'Save Error: Make sure you have entered a Name, at least one address field, and Latitude and Longitude fields');
                }
                        
            });            
            
            //Handle Edit Existing Save
            $('#adminsettings .buttons-edit .savebtn').click(function () 
            {
                //build settings objects
                var settings = {
                	CheckInPostTo			: $('.editbaseobjectdetails .checkin-postto').val(),
                	VerificationDistance	: $('.editbaseobjectdetails .verification-distance').val(),
                	VerificationUnit		: $('.editbaseobjectdetails .verification-unit').val(),
                	VerificationRequired	: $('.editbaseobjectdetails .verification-required').is(':checked')
                };
                var BaseObject = {
                    Id:                         $('#adminsettings select.baseobject').val(),
                    AddressObject__c:      $("select.editbaseobjectdetails[data='addressloc']").val(),
                    Name__c:               $('#adminsettings input.editname').val(),
                    SkipFailedGeocodes__c: $('#editskipfailedgeocodes').is(':checked'),
                    Street__c:             $('#editstreet').val() == '--Please Choose--' ? '' : $('#editstreet').val(),
                    PostalCode__c:         $('#editpostalcode').val() == '--Please Choose--' ? '' : $('#editpostalcode').val(),
                    City__c:               $('#editcity').val() == '--Please Choose--' ? '' : $('#editcity').val(),
                    Country__c:            $('#editcountry').val() == '--Please Choose--' ? '' : $('#editcountry').val(),
                    State__c:              $('#editstate').val() == '--Please Choose--' ? '' : $('#editstate').val(),
                    Latitude__c:           $('#editlatitude').val() == '--Please Choose--' ? '' : $('#editlatitude').val(),
                    Longitude__c:          $('#editlongitude').val() == '--Please Choose--' ? '' : $('#editlongitude').val(),
                    VerifiedLatitude__c:   $('#editverifiedlatitude').val() == '--Please Choose--' ? '' : $('#editverifiedlatitude').val(),
                    VerifiedLongitude__c:  $('#editverifiedlongitude').val() == '--Please Choose--' ? '' : $('#editverifiedlongitude').val(),
                    CleanStreet__c:        $('#editcleanstreet').val() == '--Please Choose--' ? '' : $('#editcleanstreet').val(),
                    CleanCity__c:          $('#editcleancity').val() == '--Please Choose--' ? '' : $('#editcleancity').val(),
                    CleanState__c:         $('#editcleanstate').val() == '--Please Choose--' ? '' : $('#editcleanstate').val(),
                    CleanPostalCode__c:    $('#editcleanzip').val() == '--Please Choose--' ? '' : $('#editcleanzip').val(),
                    CleanCountry__c:       $('#editcleancountry').val() == '--Please Choose--' ? '' : $('#editcleancountry').val(),
                    CleanCounty__c:        $('#editcleancounty').val() == '--Please Choose--' ? '' : $('#editcleancounty').val(),
                    CleanDistrict__c:      $('#editcleandistrict').val() == '--Please Choose--' ? '' : $('#editcleandistrict').val(),
                    Similarity__c:         $('#editsimilarity').val() == '--Please Choose--' ? '' : $('#editsimilarity').val(),
                    Quality__c:            $('#editquality').val() == '--Please Choose--' ? '' : $('#editquality').val(),
                    Settings__c: 			JSON.stringify(settings)
                };
                
                //determine if at least one address field is filled in
                var addressFields = ['Street__c','City__c','State__c','PostalCode__c','Country__c'];
                var addressFieldsValid = false;
                $.each(addressFields, function (index, fieldName) {
                	if (BaseObject[fieldName] != undefined && BaseObject[fieldName] != '') {
                		addressFieldsValid = true;
                		return false;
                	}
                });
                
                //make sure we have all the required fields filled in
                if(addressFieldsValid && BaseObject.Name__c != undefined && BaseObject.Name__c != '' && BaseObject.Latitude__c != undefined && BaseObject.Latitude__c != '' && BaseObject.Longitude__c != undefined && BaseObject.Longitude__c != '')
                {
                    //add saving indicator
                    var $tab = showLoading($(this).closest('.ui-tabs-panel'), 'Saving...');
            
                    $.ajax({
                        url: "/apex/MAAdminAJAXResources?securityToken={!securityToken}&action=save_base_object",
                        type: 'POST',
                        dataType: 'JSON',
                        data: { BaseObject: JSON.stringify(addNamespace('{!namespace}', BaseObject)) },
                        success: function (json)
                        {
                            if (json.success)
                            {
                            	showSuccess($tab, 'Edit Successful', 1500, function () {
                            		//FillBaseObjectComboBoxes();
                                	//HideAll();
                            	});
                            }
                            else
                            {
                                //show error message
                                showError($tab, 'Save Error: Please try again');
                            }
                        },
                        error: function (request, error, exception)
                        {
                            //show error
                            showError($tab, 'Save Error: Please try again');
                        }
                    });     
                }
                else
                {
                    showError($(this).closest('.ui-tabs-panel'), 'Save Error: Make sure you have entered a Name, at least one address field, and Latitude and Longitude fields');
                }
                        
            });
                        
            //Handle Delete
            $('#adminsettings .buttons-delete .deletebtn').click(function () 
            { 
                //add delete indicator
                var $tab = showLoading($(this).closest('.ui-tabs-panel'), 'Deleting...');
                
                $.getJSON("/apex/MAAdminAJAXResources","securityToken={!securityToken}&action=delete_base_object&object=" + $('#adminsettings select.deletebaseobject').val(),function(json)
                { 
                    if(json.success)
                    {
                         showSuccess($tab, 'Delete Successful', 1500, function () {
                         	FillBaseObjectComboBoxes();
                         	HideAll();
                         });
                    }
                    else
                    {  
                        showError($tab, 'Save Error: Please try again');
                    }
                })
                .error(function(jqXHR, textStatus, errorThrown) {        
                    //show error
                    showError($tab, 'Save Error: Please try again');
                });
            });                  
        });
        
        function FillBaseObjectComboBoxes()
        {
            //Clear options and set first child Loading indicator
            var $availableobject = $('select.availableobject');
            $availableobject.find('option:first-child').text('Loading...');
            $availableobject.find('option:not(:first-child)').remove();            
            var $baseobject = $('select[data="baseobject"]');
            $baseobject.find('option:first-child').text('Loading...');
            $baseobject.find('option:not(:first-child)').remove(); 
                  
            //Get Base Object for comboboxes
            $.getJSON("/apex/MAAdminAJAXResources","securityToken={!securityToken}&action=populate_base_objects",function(json)
            { 
                if(json.success)
                {        
                    $.each(json.available, function (i, record) 
                    {
                            $('<option></option>').attr('value', record.label).text(record.name).appendTo($availableobject);                
                    }); 
                    $availableobject.removeAttr('disabled').find('option:first-child').text('--None--').attr('selected',true);
                    $availableobject.each(function(i, obj) {                          
                        $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                    });
                    $availableobject.combobox();                    
                    
                                         
                    $.each(json.existing, function (i, record) 
                    {
                    	//namespace removal
                    	removeNamespace('{!namespace}', record);
                    	
                        $('<option></option>').attr('value', record.Id).text(record.Name__c).appendTo($baseobject);                
                    }); 
                    $baseobject.removeAttr('disabled').find('option:first-child').text('--None--').attr('selected',true);
                    $baseobject.each(function(i, obj) {                          
                        $(this).next().find('.ui-autocomplete-input').val($(this).find('option:selected').text());                            
                    });
                    $baseobject.combobox();
                }
                else
                {
                    $('#adminsettings .buttons-create .msgs').html('<b>Error retrieving Base Object list</b>: Please try again').show();
                }
            })
            .error(function(jqXHR, textStatus, errorThrown) { 
                
                $('#adminsettings .buttons-create .msgs').html('<b>Error retrieving Base Object list</b>: ' + textStatus + ' : ' + errorThrown).show(); 
            });
        }
        
        function HideAll()
        {
            //Hide Tabs and Buttons
            $('.availableobject-settings').hide();
            $('.baseobject-settings').hide();
            $('.buttons-create').hide();
            $('.buttons-edit').hide();
            $('.buttons-delete').hide();            
           
            //Hide error messages
            $('#adminsettings .buttons-create .msgs').hide();
            $('#adminsettings .buttons-edit .msgs').hide();
            $('#adminsettings .buttons-delete .msgs').hide();
            
            ClearAll();
        }
        
        function ClearAll()
        {
            //Clear Name fields
            $('#adminsettings input.createname').val('');
            $('#adminsettings input.editname').val('');
            
            //Clear Read-Only Base Object
            $("span.readonlybaseobject").html('');
        }
        
        function loadCreateableFields(baseObject)
        {
        	//show loading
           	showLoading($('#dialog-createfields').closest('.ui-dialog'), 'Loading...');
           	
           	//send request to get createable fields
           	var requestData = {
           		securityToken	: '{!securityToken}',
           		action			: 'get_createable_fields',
           		baseObject		: baseObject
           	};
           	$.getJSON("/apex/MAAdminAJAXResources", requestData, function(response) {
               	if (response.success)
               	{
               		//populate the createable fields table
               		$('#dialog-createfields-table .createablefield-row').remove();
               		$.each(response.createableFields, function (index, createableField) {
               		
               			//basic fields
               			var $createableFieldRow = $('#templates .createablefield-row').clone().attr('data-name', createableField.name).data('createableField', createableField);
               			$createableFieldRow.find('.createablefield-label').text(createableField.label);
               			
               			//does this field exist?
               			if (createableField.exists)
               			{
               				$createableFieldRow.find('.createablefield-exists').html("<img src='{!URLFOR($Resource.MapAnything, 'images/check-22.png')}' />");
               				
               				//if this is the skip geocoding field, make sure the checkbox for it is visible
               				if (createableField.name == 'MASkipGeocoding__c') {
               					$('#editskipfailedgeocodes').show().next().hide();
               				}
               			}
               			else
               			{
               				$createableFieldRow.find('.createablefield-exists').html("<input type='checkbox' class='createablefield-create' checked='checked' />")
               			}
               			
               			//render the row
               			$('#dialog-createfields-table').append($createableFieldRow);
               		});
               		
               		//hide loading
               		hideMessage($('#dialog-createfields').closest('.ui-dialog'));
               	}
               	else
               	{
               	}
               })
               .error(function(jqXHR, textStatus, errorThrown) { 
               });
        }
    </script>
    
    <c:MAAdminHeader PageTitle="Base Objects"/>
    
    <!-- Error State -->
    <div id='adminsettings-error'>
    
        <!-- Title -->
        <h2>Error</h2>
        <h3>An error occurred while loading this page.  Please close this window and try again.  If the problem continues, contact support.</h3>
    
        <!-- Message -->
        <div></div>        
    </div>
    
    <!-- Non-Error State -->
    <div id='adminsettings'>
        <div class="BottomTabs">
            <ul>
                <li><a href="#BottomTabs-1">Create New</a></li>
                <li><a href="#BottomTabs-2">Edit Existing</a></li>
                <li><a href="#BottomTabs-3">Remove Existing</a></li>
            </ul>
            <div id="BottomTabs-1">              
                <table style="width:100%;" cellpadding="5">
                    <tr>
                        <td style="vertical-align:top;">
                            <table cellpadding="5" cellspacing="0">
                                <tr>
                                    <td style="white-space: nowrap"><b>Base Object</b></td>
                                    <td>
                                        <select class='availableobject' data='availableobject' disabled='disabled'><option value=''>Loading...</option></select>
                                    </td>
                                </tr>
                             </table>
                          </td>
                      </tr>
                      <tr>
                          <td style="vertical-align:top;">
                              <div class='availableobject-settings'>        
                                  <div class="gray box section newbaseobjectdetails">
                                      <div class="section-header">Base Object Details</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Name</b>
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <input type='text' class='createname' style='width: 200px;' />                       
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Address Location</b>                                                    
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="createaddressloc" class='newbaseobjectdetails combobox' data='addressloc' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                          </table>
                                      </div>
                                  </div>
                                  <div class="gray box section newbaseobjectdetails">
                                      <div class="section-header">Address Fields</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Street</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="createstreet" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Postal Code</b>                                                     
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="createpostalcode" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>City</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcity" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Country</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcountry" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>State</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createstate" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td colspan="2"></td>
                                              </tr>
                                          </table>
                                      </div>                                  
                                  </div>
                                  <div class="gray box section newbaseobjectdetails">
                                      <div class="section-header">Coordinate Fields</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Latitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="createlatitude" class='newbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%">
                                                      <b>Verified Latitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="createverifiedlatitude" class='newbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style="width:10%"> 
                                                      <b>Longitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="createlongitude" class='newbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Verified Longitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="createverifiedlongitude" class='newbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                          </table>
                                      </div> 
                                  </div>
                                  <div class="gray box section newbaseobjectdetails">
                                      <div class="section-header">Address Fields</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Clean Street</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="createcleanstreet" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Similarity</b>                                                   
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="createsimilarity" class='newbaseobjectdetails combobox' data='similarityfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean City</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcleancity" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Quality</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createquality" class='newbaseobjectdetails combobox' data='qualityfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean State</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcleanstate" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Clean County</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcleancounty" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean Postal Code</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcleanzip" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Clean District</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcleandistrict" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean Country</b>
                                                  </td>
                                                  <td> 
                                                      <select id="createcleancountry" class='newbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td colspan="2"></td>
                                              </tr>
                                          </table>
                                      </div>                                  
                                  </div>
                                  
                                  <!-- Check In Settings -->
                                  <div class="gray box section newbaseobjectdetails">
	                                  <div class="section-header">Check In Settings</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                              	<td style="width:10%;"><b>Post To</b></td>
                                              	<td style="width:40%;">
                                              		<select class='checkin-postto combobox'>
                                              			<option value='Chatter'>Chatter</option>
                                              			<option value='Task'>Task</option>
                                              			<option value='Chatter|Task'>Chatter &amp; Task</option>
                                              		</select>
                                              	</td>
                                              	<td style="width:10%;"><b>Verification Distance</b></td>
                                              	<td style="width:40%;">
                                              		<input type='text' class='verification-distance' style='width: 50px;' />
					                            	<select class='verification-unit combobox'>
					                            		<option value='ft'>Feet</option>
					                            		<option value='m'>Meters</option>
					                            		<option value='km'>Kilometers</option>
					                            		<option value='mi'>Miles</option>
					                            	</select>
                                              	</td>
                                              </tr>
                                              <tr>
                                              	<td></td>
                                              	<td></td>
                                              	<td><b>Verification Required</b></td>
                                              	<td><input type='checkbox' class='verification-required' /></td>
                                              </tr>
                                          </table>
                                      </div>
                                  </div>
                                                                     
                              </div>
                          </td>
                      </tr>
                  </table>
                
                <!-- Buttons  -->
                <div class='buttons-create' style='display:none;'>
                    <input type='button' class='savebtn btn btn-blue' value='Save' />
                    <input type='button' class='suggestbtn btn btn-blue' value='Suggest' />
                    <input type='button' class='createfieldsbtn btn btn-blue' value='Create Fields...' style='width: 125px;' />              
                    <span class='msgs' style='color: red; font-size: 10px; display: none;'></span>
                </div>
            </div>
            <div id="BottomTabs-2">
                <table style="width:100%;" cellpadding="5">
                    <tr>
                        <td style="vertical-align:top;">
                            <table cellpadding="5" cellspacing="0">
                                <tr>
                                    <td style="white-space: nowrap"><b>Base Object</b></td>
                                    <td>
                                        <select class='baseobject' data='baseobject' disabled='disabled'><option value=''>Loading...</option></select>
                                    </td>
                                </tr>                                
                             </table>
                          </td>
                      </tr>
                      <tr>
                          <td style="vertical-align:top;">
                              <div class='baseobject-settings'>        
                                  <div class="gray box section editbaseobjectdetails">
                                      <div class="section-header">Base Object Details</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Name</b>
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <input type='text' class='editname' style='width: 200px;' />                       
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Address Location</b>                                                    
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id='editaddressloc' class='editbaseobjectdetails combobox' data='addressloc' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>                                                  
                                              </tr>
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Related Object</b>
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <span class='editbaseobjectdetails readonlybaseobject' style='width: 200px;' />                       
                                                  </td>
                                                  <td style="width:10%">
                                                  	<b>Skip Failed Geocodes</b>
                                                  </td>
                                                  <td style='vertical-align: middle;'>
                                                  	<input type='checkbox' id='editskipfailedgeocodes' class='editbaseobjectdetails' />
                                                  	<span style='font-size: 9px; font-style: italic; display: none;'>​Missing Required Field: Skip Geocoding (MapAnything)​</span>​
                                                  </td>
                                              </tr>
                                          </table>
                                      </div>
                                  </div>
                                  <div class="gray box section editbaseobjectdetails">
                                      <div class="section-header">Address Fields</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Street</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="editstreet" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Postal Code</b>                                                     
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="editpostalcode" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>City</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcity" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Country</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcountry" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>State</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editstate" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td colspan="2"></td>
                                              </tr>
                                          </table>
                                      </div>                                  
                                  </div>
                                  <div class="gray box section editbaseobjectdetails">
                                      <div class="section-header">Coordinate Fields</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Latitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="editlatitude" class='editbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%">
                                                      <b>Verified Latitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="editverifiedlatitude" class='editbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td style="width:10%"> 
                                                      <b>Longitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="editlongitude" class='editbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Verified Longitude</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="editverifiedlongitude" class='editbaseobjectdetails combobox' data='coordinatefield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>                                           
                                          </table>
                                      </div> 
                                  </div>
                                  <div class="gray box section editbaseobjectdetails">
                                      <div class="section-header">Address Fields</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Clean Street</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <select id="editcleanstreet" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td style="width:10%"> 
                                                      <b>Similarity</b>                                                   
                                                  </td>
                                                  <td style="width:40%">                                                       
                                                      <select id="editsimilarity" class='editbaseobjectdetails combobox' data='similarityfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean City</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcleancity" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Quality</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editquality" class='editbaseobjectdetails combobox' data='qualityfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean State</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcleanstate" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Clean County</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcleancounty" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean Postal Code</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcleanzip" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td> 
                                                      <b>Clean District</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcleandistrict" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Clean Country</b>
                                                  </td>
                                                  <td> 
                                                      <select id="editcleancountry" class='editbaseobjectdetails combobox' data='addressfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td colspan="2"></td>
                                              </tr>
                                          </table>
                                      </div>                                  
                                  </div>
                                  
                                  <!-- Check In Settings -->
                                  <div class="gray box section editbaseobjectdetails">
	                                  <div class="section-header">Check In Settings</div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                              	<td style="width:10%;"><b>Post To</b></td>
                                              	<td style="width:40%;">
                                              		<select class='checkin-postto combobox'>
                                              			<option value='Chatter'>Chatter</option>
                                              			<option value='Task'>Task</option>
                                              			<option value='Chatter|Task'>Chatter &amp; Task</option>
                                              		</select>
                                              	</td>
                                              	<td style="width:10%;"><b>Verification Distance</b></td>
                                              	<td style="width:40%;">
                                              		<input type='text' class='verification-distance' style='width: 50px;' />
					                            	<select class='verification-unit combobox'>
					                            		<option value='ft'>Feet</option>
					                            		<option value='m'>Meters</option>
					                            		<option value='km'>Kilometers</option>
					                            		<option value='mi'>Miles</option>
					                            	</select>
                                              	</td>
                                              </tr>
                                              <tr>
                                              	<td></td>
                                              	<td></td>
                                              	<td><b>Verification Required</b></td>
                                              	<td><input type='checkbox' class='verification-required' /></td>
                                              </tr>
                                          </table>
                                      </div>
                                  </div>
                                  
                                  <!-- Map It Settings -->
                                  <div class="gray box section editbaseobjectdetails">
                                      <div class="section-header">Map It Settings</div>
                                      <div class="mapitdescription"></div>
                                      <div class="section-body box">
                                          <table style="width:100%" cellpadding="5" cellspacing="0">
                                              <tr>
                                                  <td style="width:10%">
                                                      <b>Marker Color</b>                                                      
                                                  </td>
                                                  <td style="width:40%">                                                      
                                                      <input id="markercolor" class="color" value="66ff00" />
                                                  </td>
                                                  <td style="width:50%"></td>                                                  
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Tooltip 1</b>                                                      
                                                  </td>
                                                  <td>                                                      
                                                      <select id="tooltip1" class='editbaseobjectdetails combobox' data='tooltip1' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td></td> 
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Tooltip 2</b>                                                      
                                                  </td>
                                                  <td>                                                      
                                                      <select id="tooltip2" class='editbaseobjectdetails combobox' data='tooltipfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td></td> 
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Tooltip 3</b>                                                      
                                                  </td>
                                                  <td>                                                      
                                                      <select id="tooltip3" class='editbaseobjectdetails combobox' data='tooltipfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td></td> 
                                              </tr> 
                                              <tr>
                                                  <td>
                                                      <b>Tooltip 4</b>                                                      
                                                  </td>
                                                  <td>                                                      
                                                      <select id="tooltip4" class='editbaseobjectdetails combobox' data='tooltipfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td></td> 
                                              </tr> 
                                              <tr>
                                                  <td>
                                                      <b>Tooltip 5</b>                                                      
                                                  </td>
                                                  <td>                                                      
                                                      <select id="tooltip5" class='editbaseobjectdetails combobox' data='tooltipfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td></td> 
                                              </tr> 
                                              <tr>
                                                  <td>
                                                      <b>Tooltip 6</b>                                                      
                                                  </td>
                                                  <td>                                                      
                                                      <select id="tooltip6" class='editbaseobjectdetails combobox' data='tooltipfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td></td> 
                                              </tr>
                                              <tr>
                                                  <td>
                                                      <b>Tooltip 7</b>                                                      
                                                  </td>
                                                  <td>                                                      
                                                      <select id="tooltip7" class='editbaseobjectdetails combobox' data='tooltipfield' disabled='disabled'><option value=''>Loading...</option></select>                      
                                                  </td>
                                                  <td></td> 
                                              </tr>
                                              <tr style='display: none;'>
                                                  <td></td>
                                                  <td>                                                      
                                                      <input type='button' class='addqueriesbtn btn2 btn-blue' value='Add Saved Queries' />
                                                      <input type='checkbox' class='plotvisibleflag'><b>Plot Visible Area</b></input>
                                                  </td>
                                                  <td></td> 
                                              </tr>     
                                              <tr>
                                                  <td>
                                                      <b>Button URL</b>                                                      
                                                  </td>
                                                  <td colspan="2">
                                                      <textarea id="mapiturl" class="mapiturl" style="width:95%;"></textarea>
                                                  </td>                                                 
                                              </tr>
                                              <tr>
                                                  <td></td>
                                                  <td>
                                                      <input type='button' class='selecturlbtn btn btn-blue' value='Select' />
                                                  </td>
                                                  <td></td>                                                 
                                              </tr>                                                    
                                          </table>
                                      </div>                                  
                                  </div>                                   
                              </div>
                          </td>
                      </tr>
                </table>
                

                
                <!-- Buttons  -->
                <div class='buttons-edit' style='display:none;'>
                    <input type='button' class='savebtn btn btn-blue' value='Save' />
                    <input type='button' class='suggestbtn btn btn-blue' value='Suggest' />
                    <input type='button' class='createfieldsbtn btn btn-blue' value='Create Fields...' style='width: 125px;' />  
                    <span class='msgs' style='color: red; font-size: 10px; display: none;'></span>
                </div>
            </div>
            <div id="BottomTabs-3">
                <table style="width:100%;" cellpadding="5">
                    <tr>
                        <td style="vertical-align:top;">
                            <table cellpadding="5" cellspacing="0">
                                <tr>
                                    <td style="white-space: nowrap"><b>Base Object</b></td>
                                    <td>
                                        <select class='deletebaseobject' data='baseobject' disabled='disabled'><option value=''>Loading...</option></select>
                                    </td>
                                </tr>
                             </table>
                          </td>
                      </tr>
                </table>
                  
                <!-- Buttons  -->
                <div class='buttons-delete' style='display:none;'>
                    <input type='button' class='deletebtn btn btn-blue' value='Delete' />
                    <span class='msgs' style='color: red; font-size: 10px; display: none;'></span>
                </div>
            </div>
        </div>
    </div>
    
    <div id="dialog-SQTree" title="Saved Queries" style="display:none;" >
        <div id="SQTree" style="padding-top:3px;width:95%;height:auto;"></div>
    </div>
    
    <!-- Create Fields Popup -->
    <div id='dialog-createfields' style='display: none;'>
    	
    	<!-- Header -->
    	<h2>Create Fields</h2>
    	
    	<!-- Spacer -->
    	<div style='height: 10px;'>&nbsp;</div>
    	
    	<!-- Field Table -->
    	<div id='dialog-createfields-table-wrapper' class='loadmask-wrapper'>
    		<table id='dialog-createfields-table' class='grid-blue'>
    			<tr>
    				<th>Field</th>
    				<th style='text-align: center;'><span class='link selectall'>All</span> | <span class='link selectnone'>None</span></th>
    			</tr>
    		</table>
    	</div>
    	
    </div>
    
    <!-- Templates -->
    <div id='templates' style='display: none;'>
    	
    	<!-- Row Templates -->
    	<table>
    		<tr class='createablefield-row'>
    			<td class='createablefield-label'></td>
    			<td class='createablefield-exists'></td>
    		</tr>
    	</table>
    	
    </div>
    
</apex:page>